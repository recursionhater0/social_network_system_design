# Social Network For Tourists

## Требования

### Функциональные требования

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

### Нефункциональные требования

#### Аудитория приложения

- Количество пользователей.
  - 100 000 DAU
- Поведение пользователей.
  - Один пользователь в среднем в день:
    - будет создавать 5 постов;
    - будет оставлять 3 комментария;
    - будет ставить 5 реакций;
    - будет подписываться на 5 пользователей;
    - будет искать 20 мест для путешествий;
    - будет читать 30 постов в ленте;
    - будет читать 20 комментариев;
- Регионы использования приложения.
  - Только в странах СНГ.

#### Особенности приложения

- Сезонность приложения.
  - Высокий сезон (май-сентябрь) - нагрузка от обычной в 3 раза больше
- Условия хранения данных.
  - Храним всегда
- Лимиты и ограничения
  - Один пользователь в день:
    - может создавать не больше 20 постов;
    - может оставлять не больше 50 комментариев;
    - может ставить не больше 100 реакций;
    - может подписываться на не больше 30 пользователей;
    - может искать неограниченное количество мест для путешествий;
    - может читать неограниченное количество постов в ленте;
  - Максимальное количество символов в 1 посте равно 63 206.
  - Максимальное количество картинок в 1 посте равно 10.
  - Максимальное количество символов в 1 комментарии 8 000.
  - Максимальное количество картинок в 1 комментарии 1.
  - 1 картинка может весить не больше 5Mb.
  - В среднем на 1 посте 15 000 реакций.
- Временные ограничения.
  - один пост должен публиковаться не дольше 1 секунды;
  - счетчик реакций на сообщения должен обновляться не дольше 10 секунд;
  - комментарий должен публиковаться не дольше 1 секунды;
  - подписка на человека должна срабатывать не дольше 3 секунд;
  - поиск мест для путешествий должен работать не дольше 2 секунд;
  - посты в ленте должны загружаться не дольше 2 секунд;
- Доступность приложения
  - 99.99% - в год простой не больше 52.60 минут.

## Оценка нагрузки

### Посты

#### RPS

```
1. RPS (write) = 100 000 * 5 (в среднем создает 1 пользователь) / 86 400 = 5.78
2. RPS (read) = 100 000 * 30 / 86 400 = 34.7
```
#### Traffic

Будем считать по максимуму. 1 пользователь создал пост на 63 206 символов. Так как аудитория стран СНГ, то с высокой долей вероятности алфавит будет кириллицей. Символ из кириллицы занимает 2 байта. Следовательно,

```
63 206 символов × 2 байта = 126 412 байт ≈ 123 KB
```

Так же допустим, что пользователь в среднем загружает 4 картинки по 4 Mb. Тогда:

```
4 картинок × 4 Mb (средний) = 16 MB = 16 384 KB
```

Если сложить картинки и текст, то выйдет:

```
16 384 KB + 123 KB = 16 507 Kb
```

Так же есть метаинформация: автор поста, время, геолокация. Предположим, что автор - это некий UUID (16 байт). Время поста - timestamp (8 байт). Геолокация - это
координаты (16 байт) + название места (50 байт). Тогда размер метаинформации

```
16 + 8 + 16 + 50 = 90 B = 0.088 KB
```

Метаинформацией можно пренебречь

```
1. Traffic (write) = 5.78 * 16 507 Kb = 95 410 Kb = 95 Mb
2. Traffic (read) = 34.7 * 16 507 Kb = 572 792 Kb = 572 Mb
```

### Реакции

Когда пользователь читает 30 постов в день, вместе с каждым постом обычно загружается информация о реакциях (минимум счетчик, возможно топ-3 эмодзи).
#### RPS

```
1. RPS (write) = 100 000 * 5 (в среднем ставит 1 пользователь) / 86 400 = 5.78
2. RPS (read) = 100 000 * 30 / 86 400 = 34.7
```

Для расчета чтения реакция я сделал предположение, что пользователь, как правило, читает посты и редко смотрит реакции на них.

#### Traffic

Одна реакция - это эмодзи. Эмодзи занимают 4 байта.  Топ-3 эмодзи с их количеством: 3 × (4 байта эмодзи + 4 байта счетчик) = 24 байта. Счетчик реакций: 4 байта (int32)

```
1. Traffic (write) = 5.78 * 4 = 23.1 B
2. Traffic (read) = 34.7 * 28 B = 971.6 B/s ≈ 1 KB/s
```
### Комментарии

#### RPS

```
1. RPS (write) = 100 000 * 3 / 86 400 = 3.47
2. RPS (read) = 100 000 * 20 / 86 400 = 23.1
```

#### Traffic

Предположим, что пользователь использует все 8 000 символов для комментариев. Так как аудитория стран СНГ, то с высокой долей вероятности алфавит будет кириллицей. Символ из кириллицы занимает 2 байта. Следовательно,

```
8 000 символов × 2 байта = 16 000 B ≈ 16 Kb
```

```
1. Traffic (write) = 3.47 * 16 KbB = 55 Kb
2. Traffic (read) = 23.1 * 16 Kb = 369.6 Kb
```

## Оценка дисков

### Посты

#### Capacity

```
1. Capacity = 95 Mb * 86 400 * 365 = 2 995 920 000 Mb = 3 Pb = 3 000 Tb
```

#### Диски

HDD:

```
1. Disks_for_capacity = 3 000 Tb / 32 Tb = 94
2. Disks_for_throughput = 667 Mb / 100 Mb/s = 7 (округляем в большую)
3. Disks_for_iops = 40 / 100 = 0.4 = 1 (округляем в большую)
4. Disks = max(94, 7, 1) = 94
```

SSD (SATA)

```
1. Disks_for_capacity = 3 000 Tb / 100 Tb = 30
2. Disks_for_throughput = 667 Mb / 500 Mb/s = 2 (округляем в большую)
3. Disks_for_iops = 40 / 1000 = 0.04 = 1 (округляем в большую)
4. Disks = max(30, 2, 1) = 30
```

SSD (nVME)

```
1. Disks_for_capacity = 3 000 Tb / 30 Tb = 100
2. Disks_for_throughput = 667 Mb / 3 000 Mb/s = 1 (округляем в большую)
3. Disks_for_iops = 40 / 10000 = 0.004 = 1 (округляем в большую)
4. Disks = max(100, 1, 1) = 100
```

Я выбрал SSD (SATA), так как нужно хранить много данных, но RPS и трафика у меня не так много. С SATA выходит наименьшее количество дисков.
### Реакции

```
1. Capacity = 23.1 B * 86 400 * 365 = 728 481 600 B = 728 Mb = 0.7 Gb
```

HDD:

```
1. Disks_for_capacity = 0.7 GB / 32 TB = 0.00002 = 1
2. Disks_for_throughput = 24 / 100 = 1
3. Disks_for_iops = 39 / 100 = 1
4. Disks = 1
```

Считать для других дисков смысла нет, поэтому выберем HDD как основное хранилище для реакций.
### Комментарии

```
1. Capacity = 55 KB * 86 400 * 365 = 1 734 480 000 KB ≈ 1 654 GB ≈ 1.6 TB
```

HDD:

```
1. Disks_for_capacity = 1.6 TB / 32 TB = 0.05 ≈ 1
2. Disks_for_throughput = 424 / 100 = 4.2 = 5
3. Disks_for_iops = 27 / 100 = 0.27 = 1
4. Disks = max(1, 5, 1) = 5
```

SSD (SATA):

```
1. Disks_for_capacity = 1.6 TB / 100 TB = 0.016 ≈ 1
2. Disks_for_throughput = пренебрежимо мало
3. Disks_for_iops = пренебрежимо мало
4. Disks = 1
```

SSD (NVMe):

```
1. Disks_for_capacity = 1.6 TB / 30 TB = 0.053 ≈ 1
2. Disks_for_throughput = пренебрежимо мало
3. Disks_for_iops = пренебрежимо мало
4. Disks = 1
```

Выберем HDD, так как наиболее дешевый
